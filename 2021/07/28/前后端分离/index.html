<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>Hexo</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="icon" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"example.com","root":"/","title":"逍遥一小生","version":"1.6.1","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="前后端分离项目文章总体分为2大部分，Java后端接口和vue前端页面，比较长，因为不想分开发布 先看效果：   不多说，开始敲代码。 Java后端接口开发1、前言从零开始搭建一个项目骨架，最好选择合适，熟悉的技术，并且在未来易拓展，适合微服务化体系等。所以一般以Springboot作为我们的框架基础，这是离不开的了。 然后数据层，我们常用的是Mybatis，易上手，方便维护。但是单表操作比较困难，">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="前后端分离项目文章总体分为2大部分，Java后端接口和vue前端页面，比较长，因为不想分开发布 先看效果：   不多说，开始敲代码。 Java后端接口开发1、前言从零开始搭建一个项目骨架，最好选择合适，熟悉的技术，并且在未来易拓展，适合微服务化体系等。所以一般以Springboot作为我们的框架基础，这是离不开的了。 然后数据层，我们常用的是Mybatis，易上手，方便维护。但是单表操作比较困难，">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9185aabf1">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae928eab37d">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9185fa3e2">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae91837ec77">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae923568c9c">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9524d355a">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae94b89988f">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae95678ee6a">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae952468938">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9568052ba">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae961d9cee9">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae97fe547a2">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9801251e0">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9870770cb">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9988c77fc">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9934c09b7">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9b6f2f82a">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9c0da7a02">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9c4c440a3">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9cb783513">
<meta property="og:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9d7e97e21">
<meta property="article:published_time" content="2021-07-28T03:34:12.995Z">
<meta property="article:modified_time" content="2020-06-18T06:46:31.000Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9185aabf1"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/about/" title="John Doe"><img width="96" loading="lazy" src="/img/1.jpg" alt="John Doe"><span class="site-author-status" title="一点浩然气，千里快哉风！">😊</span></a><div class="site-author-name"><a href="/about/">John Doe</a></div><span class="site-name">Hexo</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">22</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">0</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">0</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=kZJzggTTCf4SpvEQ8lXWoi5ZjhAx0ILZ&amp;jump_from=webapi" title="QQ  2038527170" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/qas15782/" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/" title="豆瓣" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=1659649930" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/472753721" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://cdn.jsdelivr.net" title="微信公众号" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://baidu.com" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="2038527170@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-train-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">前后端分离项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">2.</span> <span class="toc-text">Java后端接口开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%89%8D%E8%A8%80"><span class="toc-number">2.1.</span> <span class="toc-text">1、前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%96%B0%E5%BB%BASpringboot%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.2.</span> <span class="toc-text">2、新建Springboot项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%95%B4%E5%90%88mybatis-plus"><span class="toc-number">2.3.</span> <span class="toc-text">3、整合mybatis plus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%BB%9F%E4%B8%80%E7%BB%93%E6%9E%9C%E5%B0%81%E8%A3%85"><span class="toc-number">2.4.</span> <span class="toc-text">3、统一结果封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%95%B4%E5%90%88shiro-jwt%EF%BC%8C%E5%B9%B6%E4%BC%9A%E8%AF%9D%E5%85%B1%E4%BA%AB"><span class="toc-number">2.5.</span> <span class="toc-text">4、整合shiro+jwt，并会话共享</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ShiroConfig"><span class="toc-number">2.5.1.</span> <span class="toc-text">ShiroConfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AccountRealm"><span class="toc-number">2.5.2.</span> <span class="toc-text">AccountRealm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JwtToken"><span class="toc-number">2.5.3.</span> <span class="toc-text">JwtToken</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AccountProfile"><span class="toc-number">2.5.4.</span> <span class="toc-text">AccountProfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JwtFilter"><span class="toc-number">2.5.5.</span> <span class="toc-text">JwtFilter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.6.</span> <span class="toc-text">5、异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%AE%9E%E4%BD%93%E6%A0%A1%E9%AA%8C"><span class="toc-number">2.7.</span> <span class="toc-text">6、实体校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">2.8.</span> <span class="toc-text">7、跨域问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">2.9.</span> <span class="toc-text">8、登录接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E5%8D%9A%E5%AE%A2%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">2.10.</span> <span class="toc-text">9、博客接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E5%90%8E%E7%AB%AF%E6%80%BB%E7%BB%93"><span class="toc-number">2.11.</span> <span class="toc-text">10、后端总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">3.</span> <span class="toc-text">Vue前端页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%89%8D%E8%A8%80-1"><span class="toc-number">3.1.</span> <span class="toc-text">1、前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%A1%B9%E7%9B%AE%E6%BC%94%E7%A4%BA"><span class="toc-number">3.2.</span> <span class="toc-text">2、项目演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">3.3.</span> <span class="toc-text">3、环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.4.</span> <span class="toc-text">4、新建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%AE%89%E8%A3%85element-ui"><span class="toc-number">3.5.</span> <span class="toc-text">5、安装element-ui</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%AE%89%E8%A3%85axios"><span class="toc-number">3.6.</span> <span class="toc-text">6、安装axios</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1"><span class="toc-number">3.7.</span> <span class="toc-text">7、页面路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.8.</span> <span class="toc-text">8、登录页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#token%E7%9A%84%E7%8A%B6%E6%80%81%E5%90%8C%E6%AD%A5"><span class="toc-number">3.8.1.</span> <span class="toc-text">token的状态同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%85%A8%E5%B1%80axios%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">3.8.2.</span> <span class="toc-text">定义全局axios拦截器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E5%8D%9A%E5%AE%A2%E5%88%97%E8%A1%A8"><span class="toc-number">3.9.</span> <span class="toc-text">9、博客列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%B4%E9%83%A8%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">3.9.1.</span> <span class="toc-text">头部用户信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%9A%E5%AE%A2%E5%88%86%E9%A1%B5"><span class="toc-number">3.9.2.</span> <span class="toc-text">博客分页</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E5%8D%9A%E5%AE%A2%E7%BC%96%E8%BE%91%EF%BC%88%E5%8F%91%E8%A1%A8%EF%BC%89"><span class="toc-number">3.10.</span> <span class="toc-text">10、博客编辑（发表）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mavon-editor"><span class="toc-number">3.10.1.</span> <span class="toc-text">安装mavon-editor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81%E5%8D%9A%E5%AE%A2%E8%AF%A6%E6%83%85"><span class="toc-number">3.11.</span> <span class="toc-text">11、博客详情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81%E8%B7%AF%E7%94%B1%E6%9D%83%E9%99%90%E6%8B%A6%E6%88%AA"><span class="toc-number">3.12.</span> <span class="toc-text">12、路由权限拦截</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13%E3%80%81%E5%89%8D%E7%AB%AF%E6%80%BB%E7%BB%93"><span class="toc-number">3.13.</span> <span class="toc-text">13、前端总结</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="John Doe"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"></h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2021-07-28 11:34:12" itemprop="dateCreated datePublished" datetime="2021-07-28T11:34:12+08:00">2021-07-28</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="Modified: 2020-06-18 14:46:31" itemprop="dateModified" datetime="2020-06-18T14:46:31+08:00">2020-06-18</time></div><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="前后端分离项目"><a href="#前后端分离项目" class="headerlink" title="前后端分离项目"></a>前后端分离项目</h2><p>文章总体分为2大部分，Java后端接口和vue前端页面，比较长，因为不想分开发布</p>
<p>先看效果：</p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9185aabf1" alt="图片" loading="lazy"></p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae928eab37d" alt="图片" loading="lazy"></p>
<p>不多说，开始敲代码。</p>
<h2 id="Java后端接口开发"><a href="#Java后端接口开发" class="headerlink" title="Java后端接口开发"></a>Java后端接口开发</h2><h3 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h3><p>从零开始搭建一个项目骨架，最好选择合适，熟悉的技术，并且在未来易拓展，适合微服务化体系等。所以一般以Springboot作为我们的框架基础，这是离不开的了。</p>
<p>然后数据层，我们常用的是Mybatis，易上手，方便维护。但是单表操作比较困难，特别是添加字段或减少字段的时候，比较繁琐，所以这里我推荐使用Mybatis Plus（<a target="_blank" rel="noopener" href="https://mp.baomidou.com/%EF%BC%89%EF%BC%8C%E4%B8%BA%E7%AE%80%E5%8C%96%E5%BC%80%E5%8F%91%E8%80%8C%E7%94%9F%EF%BC%8C%E5%8F%AA%E9%9C%80%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%8D%B3%E5%8F%AF%E5%BF%AB%E9%80%9F%E8%BF%9B%E8%A1%8C">mp.baomidou.com/），为简化开发而生，只…</a> CRUD 操作，从而节省大量时间。</p>
<p>作为一个项目骨架，权限也是我们不能忽略的，Shiro配置简单，使用也简单，所以使用Shiro作为我们的的权限。</p>
<p>考虑到项目可能需要部署多台，这时候我们的会话等信息需要共享，Redis是现在主流的缓存中间件，也适合我们的项目。</p>
<p>然后因为前后端分离，所以我们使用jwt作为我们用户身份凭证。</p>
<p>ok，我们现在就开始搭建我们的项目脚手架！</p>
<p>技术栈：</p>
<ul>
<li>SpringBoot</li>
<li>mybatis plus</li>
<li>shiro</li>
<li>lombok</li>
<li>redis</li>
<li>hibernate validatior</li>
<li>jwt</li>
</ul>
<p>导图：<a target="_blank" rel="noopener" href="https://www.markerhub.com/map/131">www.markerhub.com/map/131</a></p>
<h3 id="2、新建Springboot项目"><a href="#2、新建Springboot项目" class="headerlink" title="2、新建Springboot项目"></a>2、新建Springboot项目</h3><p>这里，我们使用IDEA来开发我们项目，新建步骤比较简单，我们就不截图了。</p>
<p>开发工具与环境：</p>
<ul>
<li>idea</li>
<li>mysql</li>
<li>jdk 8</li>
<li>maven3.3.9</li>
</ul>
<p>新建好的项目结构如下，SpringBoot版本使用的目前最新的2.2.6.RELEASE版本</p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9185fa3e2" alt="图片" loading="lazy"></p>
<p>pom的jar包导入如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>devtools：项目的热加载重启插件</li>
<li>lombok：简化代码的工具</li>
</ul>
<h3 id="3、整合mybatis-plus"><a href="#3、整合mybatis-plus" class="headerlink" title="3、整合mybatis plus"></a>3、整合mybatis plus</h3><p>接下来，我们来整合mybatis plus，让项目能完成基本的增删改查操作。步骤很简单：可以去官网看看：<a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/install.html">mp.baomidou.com/guide/insta…</a></p>
<p><strong>第一步：导入jar包</strong></p>
<p>pom中导入mybatis plus的jar包，因为后面会涉及到代码生成，所以我们还需要导入页面模板引擎，这里我们用的是freemarker。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mp--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mp代码生成器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>第二步：然后去写配置文件</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DataSource Config</span></span><br><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">datasource</span>:<span class="string"></span></span><br><span class="line">    <span class="meta">driver-class-name</span>: <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">jdbc:mysql://localhost:3306/vueblog?useUnicode=true&amp;useSSL=false&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username</span>: <span class="string">root</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">admin</span></span><br><span class="line"><span class="meta">mybatis-plus</span>:<span class="string"></span></span><br><span class="line">  <span class="meta">mapper-locations</span>: <span class="string">classpath*:/mapper/**Mapper.xml</span></span><br></pre></td></tr></table></figure>

<p>上面除了配置数据库的信息，还配置了myabtis plus的mapper的xml文件的扫描路径，这一步不要忘记了。 <strong>第三步：开启mapper接口扫描，添加分页插件</strong></p>
<p>新建一个包：通过@mapperScan注解指定要变成实现类的接口所在的包，然后包下面的所有接口在编译之后都会生成相应的实现类。PaginationInterceptor是一个分页插件。</p>
<ul>
<li>com.markerhub.config.MybatisPlusConfig</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.markerhub.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PaginationInterceptor paginationInterceptor = <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>第四步：代码生成</strong></p>
<p>如果你没再用其他插件，那么现在就已经可以使用mybatis plus了，官方给我们提供了一个代码生成器，然后我写上自己的参数之后，就可以直接根据数据库表信息生成entity、service、mapper等接口和实现类。</p>
<ul>
<li>com.markerhub.CodeGenerator</li>
</ul>
<p>因为代码比较长，就不贴出来了，在代码仓库上看哈！</p>
<p>首先我在数据库中新建了一个user表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `m_user` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `avatar` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">5</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `created` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `last_login` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `UK_USERNAME` (`username`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `m_blog` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` longtext,</span><br><span class="line">  `created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">ON</span> UPDATE <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `status` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">11</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `vueblog`.`m_user` (`id`, `username`, `avatar`, `email`, `password`, `status`, `created`, `last_login`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;markerhub&#x27;</span>, <span class="string">&#x27;https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/5a9f48118166308daba8b6da7e466aab.jpg&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;96e79218965eb72c92a549dd5a330112&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2020-04-20 10:44:01&#x27;</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>运行CodeGenerator的main方法，输入表名：m_user，生成结果如下： </p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae91837ec77" alt="图片" loading="lazy"></p>
<p>得到：</p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae923568c9c" alt="图片" loading="lazy"></p>
<p>简洁！方便！经过上面的步骤，基本上我们已经把mybatis plus框架集成到项目中了。</p>
<p>ps：额，注意一下m_blog表的代码也生成一下哈。</p>
<p>在UserController中写个测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">test</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问：<a target="_blank" rel="noopener" href="http://localhost:8080/user/1">http://localhost:8080/user/1</a> 获得结果如下，整合成功！ </p>
<p>![图片](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="562" height="240"></svg>)</p>
<h3 id="3、统一结果封装"><a href="#3、统一结果封装" class="headerlink" title="3、统一结果封装"></a>3、统一结果封装</h3><p>这里我们用到了一个Result的类，这个用于我们的异步统一返回的结果封装。一般来说，结果里面有几个要素必要的</p>
<ul>
<li>是否成功，可用code表示（如200表示成功，400表示异常）</li>
<li>结果消息</li>
<li>结果数据</li>
</ul>
<p>所以可得到封装如下：</p>
<ul>
<li>com.markerhub.common.lang.Result</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">succ</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">        Result m = <span class="keyword">new</span> Result();</span><br><span class="line">        m.setCode(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        m.setData(data);</span><br><span class="line">        m.setMsg(<span class="string">&quot;操作成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">succ</span><span class="params">(String mess, Object data)</span> </span>&#123;</span><br><span class="line">        Result m = <span class="keyword">new</span> Result();</span><br><span class="line">        m.setCode(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        m.setData(data);</span><br><span class="line">        m.setMsg(mess);</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">fail</span><span class="params">(String mess)</span> </span>&#123;</span><br><span class="line">        Result m = <span class="keyword">new</span> Result();</span><br><span class="line">        m.setCode(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        m.setData(<span class="keyword">null</span>);</span><br><span class="line">        m.setMsg(mess);</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">fail</span><span class="params">(String mess, Object data)</span> </span>&#123;</span><br><span class="line">        Result m = <span class="keyword">new</span> Result();</span><br><span class="line">        m.setCode(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        m.setData(data);</span><br><span class="line">        m.setMsg(mess);</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、整合shiro-jwt，并会话共享"><a href="#4、整合shiro-jwt，并会话共享" class="headerlink" title="4、整合shiro+jwt，并会话共享"></a>4、整合shiro+jwt，并会话共享</h3><p>考虑到后面可能需要做集群、负载均衡等，所以就需要会话共享，而shiro的缓存和会话信息，我们一般考虑使用redis来存储这些数据，所以，我们不仅仅需要整合shiro，同时也需要整合redis。在开源的项目中，我们找到了一个starter可以快速整合shiro-redis，配置简单，这里也推荐大家使用。</p>
<p>而因为我们需要做的是前后端分离项目的骨架，所以一般我们会采用token或者jwt作为跨域身份验证解决方案。所以整合shiro的过程中，我们需要引入jwt的身份验证过程。</p>
<p>那么我们就开始整合：</p>
<p>我们使用一个shiro-redis-spring-boot-starter的jar包，具体教程可以看官方文档：<a target="_blank" rel="noopener" href="https://github.com/alexxiyang/shiro-redis/blob/master/docs/README.md#spring-boot-starter">github.com/alexxiyang/…</a></p>
<p>第一步：导入shiro-redis的starter包：还有jwt的工具包，以及为了简化开发，我引入了hutool工具包。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.crazycake<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-redis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- hutool工具类--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jwt --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写配置：</p>
<h4 id="ShiroConfig"><a href="#ShiroConfig" class="headerlink" title="ShiroConfig"></a>ShiroConfig</h4><ul>
<li>com.markerhub.config.ShiroConfig</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * shiro启用注解拦截控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtFilter jwtFilter;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SessionManager <span class="title">sessionManager</span><span class="params">(RedisSessionDAO redisSessionDAO)</span> </span>&#123;</span><br><span class="line">        DefaultWebSessionManager sessionManager = <span class="keyword">new</span> DefaultWebSessionManager();</span><br><span class="line">        sessionManager.setSessionDAO(redisSessionDAO);</span><br><span class="line">        <span class="keyword">return</span> sessionManager;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">securityManager</span><span class="params">(AccountRealm accountRealm,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                     SessionManager sessionManager,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                     RedisCacheManager redisCacheManager)</span> </span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager(accountRealm);</span><br><span class="line">        securityManager.setSessionManager(sessionManager);</span><br><span class="line">        securityManager.setCacheManager(redisCacheManager);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 关闭shiro自带的session，详情见文档</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        DefaultSubjectDAO subjectDAO = <span class="keyword">new</span> DefaultSubjectDAO();</span><br><span class="line">        DefaultSessionStorageEvaluator defaultSessionStorageEvaluator = <span class="keyword">new</span> DefaultSessionStorageEvaluator();</span><br><span class="line">        defaultSessionStorageEvaluator.setSessionStorageEnabled(<span class="keyword">false</span>);</span><br><span class="line">        subjectDAO.setSessionStorageEvaluator(defaultSessionStorageEvaluator);</span><br><span class="line">        securityManager.setSubjectDAO(subjectDAO);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterChainDefinition <span class="title">shiroFilterChainDefinition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultShiroFilterChainDefinition chainDefinition = <span class="keyword">new</span> DefaultShiroFilterChainDefinition();</span><br><span class="line">        Map&lt;String, String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        filterMap.put(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;jwt&quot;</span>); <span class="comment">// 主要通过注解方式校验权限</span></span><br><span class="line">        chainDefinition.addPathDefinitions(filterMap);</span><br><span class="line">        <span class="keyword">return</span> chainDefinition;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(&quot;shiroFilterFactoryBean&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                         ShiroFilterChainDefinition shiroFilterChainDefinition)</span> </span>&#123;</span><br><span class="line">        ShiroFilterFactoryBean shiroFilter = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        shiroFilter.setSecurityManager(securityManager);</span><br><span class="line">        Map&lt;String, Filter&gt; filters = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        filters.put(<span class="string">&quot;jwt&quot;</span>, jwtFilter);</span><br><span class="line">        shiroFilter.setFilters(filters);</span><br><span class="line">        Map&lt;String, String&gt; filterMap = shiroFilterChainDefinition.getFilterChainMap();</span><br><span class="line">        shiroFilter.setFilterChainDefinitionMap(filterMap);</span><br><span class="line">        <span class="keyword">return</span> shiroFilter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开启注解代理（默认好像已经开启，可以不要）</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title">authorizationAttributeSourceAdvisor</span><span class="params">(SecurityManager securityManager)</span></span>&#123;</span><br><span class="line">        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="keyword">new</span> AuthorizationAttributeSourceAdvisor();</span><br><span class="line">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DefaultAdvisorAutoProxyCreator <span class="title">getDefaultAdvisorAutoProxyCreator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultAdvisorAutoProxyCreator creator = <span class="keyword">new</span> DefaultAdvisorAutoProxyCreator();</span><br><span class="line">        <span class="keyword">return</span> creator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面ShiroConfig，我们主要做了几件事情：</p>
<ol>
<li>引入RedisSessionDAO和RedisCacheManager，为了解决shiro的权限数据和会话信息能保存到redis中，实现会话共享。</li>
<li>重写了SessionManager和DefaultWebSecurityManager，同时在DefaultWebSecurityManager中为了关闭shiro自带的session方式，我们需要设置为false，这样用户就不再能通过session方式登录shiro。后面将采用jwt凭证登录。</li>
<li>在ShiroFilterChainDefinition中，我们不再通过编码形式拦截Controller访问路径，而是所有的路由都需要经过JwtFilter这个过滤器，然后判断请求头中是否含有jwt的信息，有就登录，没有就跳过。跳过之后，有Controller中的shiro注解进行再次拦截，比如@RequiresAuthentication，这样控制权限访问。</li>
</ol>
<p>那么，接下来，我们聊聊ShiroConfig中出现的AccountRealm，还有JwtFilter。</p>
<h4 id="AccountRealm"><a href="#AccountRealm" class="headerlink" title="AccountRealm"></a>AccountRealm</h4><p>AccountRealm是shiro进行登录或者权限校验的逻辑所在，算是核心了，我们需要重写3个方法，分别是</p>
<ul>
<li>supports：为了让realm支持jwt的凭证校验</li>
<li>doGetAuthorizationInfo：权限校验</li>
<li>doGetAuthenticationInfo：登录认证校验</li>
</ul>
<p>我们先来总体看看AccountRealm的代码，然后逐个分析：</p>
<ul>
<li>com.markerhub.shiro.AccountRealm</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtUtils jwtUtils;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(AuthenticationToken token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token <span class="keyword">instanceof</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        JwtToken jwt = (JwtToken) token;</span><br><span class="line">        log.info(<span class="string">&quot;jwt-----------------&gt;&#123;&#125;&quot;</span>, jwt);</span><br><span class="line">        String userId = jwtUtils.getClaimByToken((String) jwt.getPrincipal()).getSubject();</span><br><span class="line">        User user = userService.getById(Long.parseLong(userId));</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnknownAccountException(<span class="string">&quot;账户不存在！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(user.getStatus() == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LockedAccountException(<span class="string">&quot;账户已被锁定！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        AccountProfile profile = <span class="keyword">new</span> AccountProfile();</span><br><span class="line">        BeanUtil.copyProperties(user, profile);</span><br><span class="line">        log.info(<span class="string">&quot;profile-----------------&gt;&#123;&#125;&quot;</span>, profile.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(profile, jwt.getCredentials(), getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实主要就是doGetAuthenticationInfo登录认证这个方法，可以看到我们通过jwt获取到用户信息，判断用户的状态，最后异常就抛出对应的异常信息，否者封装成SimpleAuthenticationInfo返回给shiro。 接下来我们逐步分析里面出现的新类：</p>
<p>1、shiro默认supports的是UsernamePasswordToken，而我们现在采用了jwt的方式，所以这里我们自定义一个JwtToken，来完成shiro的supports方法。</p>
<h4 id="JwtToken"><a href="#JwtToken" class="headerlink" title="JwtToken"></a>JwtToken</h4><ul>
<li>com.markerhub.shiro.JwtToken</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtToken</span> <span class="keyword">implements</span> <span class="title">AuthenticationToken</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JwtToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.token = token;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getPrincipal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getCredentials</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、JwtUtils是个生成和校验jwt的工具类，其中有些jwt相关的密钥信息是从项目配置文件中配置的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;markerhub.jwt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String secret;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> expire;</span><br><span class="line">    <span class="keyword">private</span> String header;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成jwt token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generateToken</span><span class="params">(<span class="keyword">long</span> userId)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取jwt的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Claims <span class="title">getClaimByToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * token是否过期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  true：过期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTokenExpired</span><span class="params">(Date expiration)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> expiration.before(<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、而在AccountRealm我们还用到了AccountProfile，这是为了登录成功之后返回的一个用户信息的载体，</p>
<h4 id="AccountProfile"><a href="#AccountProfile" class="headerlink" title="AccountProfile"></a>AccountProfile</h4><ul>
<li>com.markerhub.shiro.AccountProfile</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountProfile</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步，ok，基本的校验的路线完成之后，我们需要少量的基本信息配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">shiro-redis</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">enabled</span>: <span class="string">true</span></span><br><span class="line">  <span class="meta">redis-manager</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">host</span>: <span class="string">127.0.0.1:6379</span></span><br><span class="line"><span class="attr">markerhub</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">jwt</span>:<span class="string"></span></span><br><span class="line"><span class="comment">    # 加密秘钥</span></span><br><span class="line">    <span class="attr">secret</span>: <span class="string">f4e2e52034348f86b67cde581c0f9eb5</span></span><br><span class="line"><span class="comment">    # token有效时长，7天，单位秒</span></span><br><span class="line">    <span class="attr">expire</span>: <span class="string">604800</span></span><br><span class="line">    <span class="attr">header</span>: <span class="string">token</span></span><br></pre></td></tr></table></figure>

<p>第四步：另外，如果你项目有使用spring-boot-devtools，需要添加一个配置文件，在resources目录下新建文件夹META-INF，然后新建文件spring-devtools.properties，这样热重启时候才不会报错。</p>
<ul>
<li>resources/META-INF/spring-devtools.properties</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">restart.include.shiro-redis</span>=<span class="string">/shiro-[\\w-\\.]+jar</span></span><br></pre></td></tr></table></figure>



<p> <img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9524d355a" alt="img" loading="lazy"> </p>
<h4 id="JwtFilter"><a href="#JwtFilter" class="headerlink" title="JwtFilter"></a>JwtFilter</h4><p>第五步：定义jwt的过滤器JwtFilter。</p>
<p>这个过滤器是我们的重点，这里我们继承的是Shiro内置的AuthenticatingFilter，一个可以内置了可以自动登录方法的的过滤器，有些同学继承BasicHttpAuthenticationFilter也是可以的。</p>
<p>我们需要重写几个方法：</p>
<ol>
<li>createToken：实现登录，我们需要生成我们自定义支持的JwtToken</li>
<li>onAccessDenied：拦截校验，当头部没有Authorization时候，我们直接通过，不需要自动登录；当带有的时候，首先我们校验jwt的有效性，没问题我们就直接执行executeLogin方法实现自动登录</li>
<li>onLoginFailure：登录异常时候进入的方法，我们直接把异常信息封装然后抛出</li>
<li>preHandle：拦截器的前置拦截，因为我们是前后端分析项目，项目中除了需要跨域全局配置之外，我们再拦截器中也需要提供跨域支持。这样，拦截器才不会在进入Controller之前就被限制了。</li>
</ol>
<p>下面我们看看总体的代码：</p>
<ul>
<li>com.markerhub.shiro.JwtFilter</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtFilter</span> <span class="keyword">extends</span> <span class="title">AuthenticatingFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtUtils jwtUtils;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationToken <span class="title">createToken</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 获取 token</span></span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        String jwt = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwt))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JwtToken(jwt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onAccessDenied</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        String token = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(token)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 判断是否已过期</span></span><br><span class="line">            Claims claim = jwtUtils.getClaimByToken(token);</span><br><span class="line">            <span class="keyword">if</span>(claim == <span class="keyword">null</span> || jwtUtils.isTokenExpired(claim.getExpiration())) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ExpiredCredentialsException(<span class="string">&quot;token已失效，请重新登录！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 执行自动登录</span></span><br><span class="line">        <span class="keyword">return</span> executeLogin(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onLoginFailure</span><span class="params">(AuthenticationToken token, AuthenticationException e, ServletRequest request, ServletResponse response)</span> </span>&#123;</span><br><span class="line">        HttpServletResponse httpResponse = (HttpServletResponse) response;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//处理登录失败的异常</span></span><br><span class="line">            Throwable throwable = e.getCause() == <span class="keyword">null</span> ? e : e.getCause();</span><br><span class="line">            Result r = Result.fail(throwable.getMessage());</span><br><span class="line">            String json = JSONUtil.toJsonStr(r);</span><br><span class="line">            httpResponse.getWriter().print(json);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对跨域提供支持</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpServletRequest httpServletRequest = WebUtils.toHttp(request);</span><br><span class="line">        HttpServletResponse httpServletResponse = WebUtils.toHttp(response);</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">&quot;Access-control-Allow-Origin&quot;</span>, httpServletRequest.getHeader(<span class="string">&quot;Origin&quot;</span>));</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;GET,POST,OPTIONS,PUT,DELETE&quot;</span>);</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, httpServletRequest.getHeader(<span class="string">&quot;Access-Control-Request-Headers&quot;</span>));</span><br><span class="line">        <span class="comment">// 跨域时会首先发送一个OPTIONS请求，这里我们给OPTIONS请求直接返回正常状态</span></span><br><span class="line">        <span class="keyword">if</span> (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) &#123;</span><br><span class="line">            httpServletResponse.setStatus(org.springframework.http.HttpStatus.OK.value());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么到这里，我们的shiro就已经完成整合进来了，并且使用了jwt进行身份校验。</p>
<h3 id="5、异常处理"><a href="#5、异常处理" class="headerlink" title="5、异常处理"></a>5、异常处理</h3><p>有时候不可避免服务器报错的情况，如果不配置异常处理机制，就会默认返回tomcat或者nginx的5XX页面，对普通用户来说，不太友好，用户也不懂什么情况。这时候需要我们程序员设计返回一个友好简单的格式给前端。</p>
<p>处理办法如下：通过使用@ControllerAdvice来进行统一异常处理，@ExceptionHandler(value = RuntimeException.class)来指定捕获的Exception各个类型异常 ，这个异常的处理，是全局的，所有类似的异常，都会跑到这个地方处理。</p>
<ul>
<li>com.markerhub.common.exception.GlobalExceptionHandler</li>
</ul>
<p>步骤二、定义全局异常处理，@ControllerAdvice表示定义全局控制器异常处理，@ExceptionHandler表示针对性异常处理，可对每种异常针对性处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExcepitonHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 捕捉shiro的异常</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.UNAUTHORIZED)</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ShiroException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">handle401</span><span class="params">(ShiroException e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="number">401</span>, e.getMessage(), <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理Assert的异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = IllegalArgumentException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">handler</span><span class="params">(IllegalArgumentException e)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;Assert异常:--------------&gt;&#123;&#125;&quot;</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> Result.fail(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Validated</span> 校验错误异常处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">handler</span><span class="params">(MethodArgumentNotValidException e)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;运行时异常:--------------&gt;&quot;</span>,e);</span><br><span class="line">        BindingResult bindingResult = e.getBindingResult();</span><br><span class="line">        ObjectError objectError = bindingResult.getAllErrors().stream().findFirst().get();</span><br><span class="line">        <span class="keyword">return</span> Result.fail(objectError.getDefaultMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = RuntimeException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">handler</span><span class="params">(RuntimeException e)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;运行时异常:--------------&gt;&quot;</span>,e);</span><br><span class="line">        <span class="keyword">return</span> Result.fail(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面我们捕捉了几个异常：</p>
<ul>
<li>ShiroException：shiro抛出的异常，比如没有权限，用户登录异常</li>
<li>IllegalArgumentException：处理Assert的异常</li>
<li>MethodArgumentNotValidException：处理实体校验的异常</li>
<li>RuntimeException：捕捉其他异常</li>
</ul>
<h3 id="6、实体校验"><a href="#6、实体校验" class="headerlink" title="6、实体校验"></a>6、实体校验</h3><p>当我们表单数据提交的时候，前端的校验我们可以使用一些类似于jQuery Validate等js插件实现，而后端我们可以使用Hibernate validatior来做校验。</p>
<p>我们使用springboot框架作为基础，那么就已经自动集成了Hibernate validatior。</p>
<p>那么用起来啥样子的呢？</p>
<p>第一步：首先在实体的属性上添加对应的校验规则，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;m_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;昵称不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;邮箱不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步 ：这里我们使用@Validated注解方式，如果实体不符合要求，系统会抛出异常，那么我们的异常处理中就捕获到MethodArgumentNotValidException。</p>
<ul>
<li>com.markerhub.controller.UserController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试实体校验</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">testUser</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> user.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7、跨域问题"><a href="#7、跨域问题" class="headerlink" title="7、跨域问题"></a>7、跨域问题</h3><p>因为是前后端分析，所以跨域问题是避免不了的，我们直接在后台进行全局跨域处理：</p>
<ul>
<li>com.markerhub.config.CorsConfig</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解决跨域问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;HEAD&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)</span><br><span class="line">                .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">                .maxAge(<span class="number">3600</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ok，因为我们系统开发的接口比较简单，所以我就不集成swagger2啦，也比较简单而已。下面我们就直接进入我们的正题，进行编写登录接口。</p>
<h3 id="8、登录接口开发"><a href="#8、登录接口开发" class="headerlink" title="8、登录接口开发"></a>8、登录接口开发</h3><p>登录的逻辑其实很简答，只需要接受账号密码，然后把用户的id生成jwt，返回给前段，为了后续的jwt的延期，所以我们把jwt放在header上。具体代码如下：</p>
<ul>
<li>com.markerhub.controller.AccountController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtUtils jwtUtils;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认账号密码：markerhub / 111111</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@CrossOrigin</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">login</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> LoginDto loginDto, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        User user = userService.getOne(<span class="keyword">new</span> QueryWrapper&lt;User&gt;().eq(<span class="string">&quot;username&quot;</span>, loginDto.getUsername()));</span><br><span class="line">        Assert.notNull(user, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!user.getPassword().equals(SecureUtil.md5(loginDto.getPassword()))) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;密码错误！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String jwt = jwtUtils.generateToken(user.getId());</span><br><span class="line">        response.setHeader(<span class="string">&quot;Authorization&quot;</span>, jwt);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="comment">// 用户可以另一个接口</span></span><br><span class="line">        <span class="keyword">return</span> Result.succ(MapUtil.builder()</span><br><span class="line">                .put(<span class="string">&quot;id&quot;</span>, user.getId())</span><br><span class="line">                .put(<span class="string">&quot;username&quot;</span>, user.getUsername())</span><br><span class="line">                .put(<span class="string">&quot;avatar&quot;</span>, user.getAvatar())</span><br><span class="line">                .put(<span class="string">&quot;email&quot;</span>, user.getEmail())</span><br><span class="line">                .map()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 退出</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="meta">@RequiresAuthentication</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SecurityUtils.getSubject().logout();</span><br><span class="line">        <span class="keyword">return</span> Result.succ(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口测试： </p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae94b89988f" alt="图片" loading="lazy"></p>
<h3 id="9、博客接口开发"><a href="#9、博客接口开发" class="headerlink" title="9、博客接口开发"></a>9、博客接口开发</h3><p>我们的骨架已经完成，接下来，我们就可以添加我们的业务接口了，下面我以一个简单的博客列表、博客详情页为例子开发：</p>
<ul>
<li>com.markerhub.controller.BlogController</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BlogService blogService;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/blogs&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">blogs</span><span class="params">(Integer currentPage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(currentPage == <span class="keyword">null</span> || currentPage &lt; <span class="number">1</span>) currentPage = <span class="number">1</span>;</span><br><span class="line">        Page page = <span class="keyword">new</span> Page(currentPage, <span class="number">5</span>)</span><br><span class="line">        IPage pageData = blogService.page(page, <span class="keyword">new</span> QueryWrapper&lt;Blog&gt;().orderByDesc(<span class="string">&quot;created&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> Result.succ(pageData);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/blog/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">detail</span><span class="params">(<span class="meta">@PathVariable(name = &quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        Blog blog = blogService.getById(id);</span><br><span class="line">        Assert.notNull(blog, <span class="string">&quot;该博客已删除！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.succ(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequiresAuthentication</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/blog/edit&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">edit</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> Blog blog)</span> </span>&#123;</span><br><span class="line">    System.out.println(blog.toString());</span><br><span class="line">    Blog temp = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(blog.getId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        temp = blogService.getById(blog.getId());</span><br><span class="line">        Assert.isTrue(temp.getUserId() == ShiroUtil.getProfile().getId(), <span class="string">&quot;没有权限编辑&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        temp = <span class="keyword">new</span> Blog();</span><br><span class="line">        temp.setUserId(ShiroUtil.getProfile().getId());</span><br><span class="line">        temp.setCreated(LocalDateTime.now());</span><br><span class="line">        temp.setStatus(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    BeanUtil.copyProperties(blog, temp, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;userId&quot;</span>, <span class="string">&quot;created&quot;</span>, <span class="string">&quot;status&quot;</span>);</span><br><span class="line">    blogService.saveOrUpdate(temp);</span><br><span class="line">    <span class="keyword">return</span> Result.succ(<span class="string">&quot;操作成功&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意@RequiresAuthentication说明需要登录之后才能访问的接口，其他需要权限的接口可以添加shiro的相关注解。 接口比较简单，我们就不多说了，基本增删改查而已。注意的是edit方法是需要登录才能操作的受限资源。</p>
<p>接口测试：</p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae95678ee6a" alt="图片" / loading="lazy">



<h3 id="10、后端总结"><a href="#10、后端总结" class="headerlink" title="10、后端总结"></a>10、后端总结</h3><p>好了，一篇文章搞定一个基本骨架，好像有点赶，但是基本的东西这里已经有了。后面我们就要去开发我们的前端接口了。</p>
<p>项目代码：<a target="_blank" rel="noopener" href="https://github.com/MarkerHub/vueblog">github.com/MarkerHub/v…</a></p>
<p>项目视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1PQ4y1P7hZ/">www.bilibili.com/video/BV1PQ…</a></p>
<h2 id="Vue前端页面开发"><a href="#Vue前端页面开发" class="headerlink" title="Vue前端页面开发"></a>Vue前端页面开发</h2><h3 id="1、前言-1"><a href="#1、前言-1" class="headerlink" title="1、前言"></a>1、前言</h3><p>接下来，我们来完成vueblog前端的部分功能。可能会使用的到技术如下：</p>
<ul>
<li>vue</li>
<li>element-ui</li>
<li>axios</li>
<li>mavon-editor</li>
<li>markdown-it</li>
<li>github-markdown-css</li>
</ul>
<p>本项目实践需要一点点vue的基础，希望你对vue的一些指令有所了解，这样我们讲解起来就简单多了哈。</p>
<h3 id="2、项目演示"><a href="#2、项目演示" class="headerlink" title="2、项目演示"></a>2、项目演示</h3><p>我们先来看下我们需要完成的项目长什么样子，考虑到很多同学的样式的掌握程度不够，所以我尽量使用了element-ui的原生组件的样式来完成整个博客的界面。不多说，直接上图：</p>
<p>在线体验：<a target="_blank" rel="noopener" href="https://markerhub.com:8083/">markerhub.com:8083</a></p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae952468938" alt="图片" style="zoom: 50%;" / loading="lazy">





<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9568052ba" alt="图片" style="zoom: 67%;" / loading="lazy">





<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae961d9cee9" alt="图片" style="zoom:67%;" / loading="lazy">



<h3 id="3、环境准备"><a href="#3、环境准备" class="headerlink" title="3、环境准备"></a>3、环境准备</h3><p>万丈高楼平地起，我们下面一步一步来完成，首先我们安装vue的环境，我实践的环境是windows 10哈。</p>
<p>1、首先我们上node.js官网(<a target="_blank" rel="noopener" href="https://nodejs.org/zh-cn/">nodejs.org/zh-cn/</a>)，下载最新的长期版本，直接运行安装完成之后，我们就已经具备了node和npm的环境啦。</p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae97fe547a2" alt="图片" style="zoom: 33%;float:left" / loading="lazy">

<p>安装完成之后检查下版本信息：</p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9801251e0" alt="图片" style="zoom:50%;float:left" / loading="lazy">

<p>2、接下来，我们安装vue的环境</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装淘宝npm</span></span><br><span class="line"><span class="attr">npm</span> <span class="string">install -g cnpm --registry=https://registry.npm.taobao.org</span></span><br><span class="line"><span class="comment"># vue-cli 安装依赖包</span></span><br><span class="line"><span class="attr">cnpm</span> <span class="string">install --g vue-cli</span></span><br></pre></td></tr></table></figure>

<h3 id="4、新建项目"><a href="#4、新建项目" class="headerlink" title="4、新建项目"></a>4、新建项目</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开vue的可视化管理工具界面</span></span><br><span class="line"><span class="attr">vue</span> <span class="string">ui</span></span><br></pre></td></tr></table></figure>

<p>上面我们分别安装了淘宝npm，cnpm是为了提高我们安装依赖的速度。vue ui是@vue/cli3.0增加一个可视化项目管理工具，可以运行项目、打包项目，检查等操作。对于初学者来说，可以少记一些命令，哈哈。 3、创建vueblog-vue项目</p>
<p>运行vue ui之后，会为我们打开一个<a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> 的页面：</p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9870770cb" alt="图片" style="zoom:50%;" / loading="lazy">



<p>然后切换到【创建】，注意创建的目录最好是和你运行vue ui同一级。这样方便管理和切换。然后点击按钮【在此创建新羡慕】</p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9988c77fc" alt="图片" style="zoom: 50%;" / loading="lazy">



<p>下一步中，项目文件夹中输入项目名称“vueblog-vue”，其他不用改，点击下一步，选择【手动】，再点击下一步，如图点击按钮，勾选上路由Router、状态管理Vuex，去掉js的校验。</p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9934c09b7" alt="图片" style="zoom:50%;" / loading="lazy">



<p>下一步中，也选上【Use history mode for router】，点击创建项目，然后弹窗中选择按钮【创建项目，不保存预设】，就进入项目创建啦。</p>
<p>稍等片刻之后，项目就初始化完成了。上面的步骤中，我们创建了一个vue项目，并且安装了Router、Vuex。这样我们后面就可以直接使用。</p>
<p>我们来看下整个vueblog-vue的项目结构</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">├── README<span class="selector-class">.md</span>            项目介绍</span><br><span class="line">├── index<span class="selector-class">.html</span>           入口页面</span><br><span class="line">├── build              构建脚本目录</span><br><span class="line">│  ├── build-server<span class="selector-class">.js</span>         运行本地构建服务器，可以访问构建后的页面</span><br><span class="line">│  ├── build<span class="selector-class">.js</span>            生产环境构建脚本</span><br><span class="line">│  ├── dev-client<span class="selector-class">.js</span>          开发服务器热重载脚本，主要用来实现开发阶段的页面自动刷新</span><br><span class="line">│  ├── dev-server<span class="selector-class">.js</span>          运行本地开发服务器</span><br><span class="line">│  ├── utils<span class="selector-class">.js</span>            构建相关工具方法</span><br><span class="line">│  ├── webpack<span class="selector-class">.base</span><span class="selector-class">.conf</span><span class="selector-class">.js</span>      wabpack基础配置</span><br><span class="line">│  ├── webpack<span class="selector-class">.dev</span><span class="selector-class">.conf</span><span class="selector-class">.js</span>       wabpack开发环境配置</span><br><span class="line">│  └── webpack<span class="selector-class">.prod</span><span class="selector-class">.conf</span><span class="selector-class">.js</span>      wabpack生产环境配置</span><br><span class="line">├── config             项目配置</span><br><span class="line">│  ├── dev<span class="selector-class">.env</span><span class="selector-class">.js</span>           开发环境变量</span><br><span class="line">│  ├── index<span class="selector-class">.js</span>            项目配置文件</span><br><span class="line">│  ├── prod<span class="selector-class">.env</span><span class="selector-class">.js</span>           生产环境变量</span><br><span class="line">│  └── test<span class="selector-class">.env</span><span class="selector-class">.js</span>           测试环境变量</span><br><span class="line">├── mock              mock数据目录</span><br><span class="line">│  └── hello<span class="selector-class">.js</span></span><br><span class="line">├── package<span class="selector-class">.json</span>          npm包配置文件，里面定义了项目的npm脚本，依赖包等信息</span><br><span class="line">├── <span class="attribute">src</span>               源码目录 </span><br><span class="line">│  ├── <span class="selector-tag">main</span><span class="selector-class">.js</span>            入口js文件</span><br><span class="line">│  ├── components         公共组件目录</span><br><span class="line">│  │  └── title<span class="selector-class">.vue</span></span><br><span class="line">│  ├── assets             资源目录，这里的资源会被wabpack构建</span><br><span class="line">│  │  └── images</span><br><span class="line">│  │    └── logo<span class="selector-class">.png</span></span><br><span class="line">│  ├── routes             前端路由:跳转的url</span><br><span class="line">│  │  └── index.js</span><br><span class="line">│  ├── store              应用级数据（state）状态管理</span><br><span class="line">│  │  └── index.js</span><br><span class="line">│  ├── app.vue ---------- 根组件:页面不变化的组件</span><br><span class="line">│  └── views ------------ 页面目录:页面变化的组件</span><br><span class="line">│    ├── hello.vue</span><br><span class="line">│    └── notfound.vue</span><br><span class="line">├── static             纯静态资源，不会被wabpack构建。</span><br><span class="line">└── test              测试文件目录（unit&amp;e2e）</span><br><span class="line">  └── unit              单元测试</span><br><span class="line">    ├── index.js            入口脚本</span><br><span class="line">    ├── karma.conf.js          karma配置文件</span><br><span class="line">    └── specs              单测case目录</span><br><span class="line">      └── Hello.spec.js</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5、安装element-ui"><a href="#5、安装element-ui" class="headerlink" title="5、安装element-ui"></a>5、安装element-ui</h3><p>接下来我们引入element-ui组件（<a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/installation">element.eleme.cn</a>），这样我们就可以获得好看的vue组件，开发好看的博客界面。</p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9b6f2f82a" alt="图片" loading="lazy"></p>
<p>命令很简单：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到项目根目录</span></span><br><span class="line"><span class="attr">cd</span> <span class="string">vueblog-vue</span></span><br><span class="line"><span class="comment"># 安装element-ui</span></span><br><span class="line"><span class="attr">cnpm</span> <span class="string">install element-ui --save</span></span><br></pre></td></tr></table></figure>

<p>然后我们打开项目src目录下的main.js，引入element-ui依赖。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import Element <span class="selector-tag">from</span> &#x27;element-ui&#x27;</span><br><span class="line">import &quot;element-ui/lib/theme-chalk/index<span class="selector-class">.css</span>&quot;</span><br><span class="line">Vue<span class="selector-class">.use</span>(Element)</span><br></pre></td></tr></table></figure>

<p>这样我们就可以愉快得在官网上选择组件到我们项目中直接使用啦。</p>
<h3 id="6、安装axios"><a href="#6、安装axios" class="headerlink" title="6、安装axios"></a>6、安装axios</h3><p>接下来，我们来安装axios（<a target="_blank" rel="noopener" href="http://www.axios-js.com/">www.axios-js.com/</a>），axios是一个基于 promise 的 HTTP 库，这样我们进行前后端对接的时候，使用这个工具可以提高我们的开发效率。</p>
<p>安装命令：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install axios --save</span><br></pre></td></tr></table></figure>

<p>然后同样我们在main.js中全局引入axios。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import axios <span class="selector-tag">from</span> &#x27;axios&#x27;</span><br><span class="line">Vue<span class="selector-class">.prototype</span>.$axios = axios //</span><br></pre></td></tr></table></figure>

<p>组件中，我们就可以通过this.$axios.get()来发起我们的请求了哈。</p>
<h3 id="7、页面路由"><a href="#7、页面路由" class="headerlink" title="7、页面路由"></a>7、页面路由</h3><p>接下来，我们先定义好路由和页面，因为我们只是做一个简单的博客项目，页面比较少，所以我们可以直接先定义好，然后在慢慢开发，这样需要用到链接的地方我们就可以直接可以使用：</p>
<p>我们在views文件夹下定义几个页面：</p>
<ul>
<li>BlogDetail.vue（博客详情页）</li>
<li>BlogEdit.vue（编辑博客）</li>
<li>Blogs.vue（博客列表）</li>
<li>Login.vue（登录页面）</li>
</ul>
<p>然后再路由中心配置：</p>
<ul>
<li>router\index.js</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import Vue <span class="selector-tag">from</span> &#x27;vue&#x27;</span><br><span class="line">import VueRouter <span class="selector-tag">from</span> &#x27;vue-router&#x27;</span><br><span class="line">import Login <span class="selector-tag">from</span> &#x27;../views/Login<span class="selector-class">.vue</span>&#x27;</span><br><span class="line">import BlogDetail <span class="selector-tag">from</span> &#x27;../views/BlogDetail<span class="selector-class">.vue</span>&#x27;</span><br><span class="line">import BlogEdit <span class="selector-tag">from</span> &#x27;../views/BlogEdit<span class="selector-class">.vue</span>&#x27;</span><br><span class="line">Vue<span class="selector-class">.use</span>(VueRouter)</span><br><span class="line">const routes = <span class="selector-attr">[  &#123;    path: <span class="string">&#x27;/&#x27;</span>,    name: <span class="string">&#x27;Index&#x27;</span>,    redirect: &#123; name: <span class="string">&#x27;Blogs&#x27;</span> &#125;  &#125;,  &#123;    path: <span class="string">&#x27;/login&#x27;</span>,    name: <span class="string">&#x27;Login&#x27;</span>,    component: Login  &#125;,  &#123;    path: <span class="string">&#x27;/blogs&#x27;</span>,    name: <span class="string">&#x27;Blogs&#x27;</span>,    // 懒加载    component: () =&gt; import(<span class="string">&#x27;../views/Blogs.vue&#x27;</span>)  &#125;,  &#123;    path: <span class="string">&#x27;/blog/add&#x27;</span>, // 注意放在 path: <span class="string">&#x27;/blog/:blogId&#x27;</span>之前    name: <span class="string">&#x27;BlogAdd&#x27;</span>,    meta: &#123;      requireAuth: true    &#125;,    component: BlogEdit  &#125;,  &#123;    path: <span class="string">&#x27;/blog/:blogId&#x27;</span>,    name: <span class="string">&#x27;BlogDetail&#x27;</span>,    component: BlogDetail  &#125;,  &#123;    path: <span class="string">&#x27;/blog/:blogId/edit&#x27;</span>,    name: <span class="string">&#x27;BlogEdit&#x27;</span>,    meta: &#123;      requireAuth: true    &#125;,    component: BlogEdit  &#125;]</span>;</span><br><span class="line">const router = new VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  base: process.env.BASE_URL,</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line">export default router</span><br></pre></td></tr></table></figure>

<p>接下来我们去开发我们的页面。其中，带有meta：requireAuth: true说明是需要登录字后才能访问的受限资源，后面我们路由权限拦截时候会用到。</p>
<h3 id="8、登录页面"><a href="#8、登录页面" class="headerlink" title="8、登录页面"></a>8、登录页面</h3><p>接下来，我们来搞一个登陆页面，表单组件我们直接在element-ui的官网上找就行了，登陆页面就两个输入框和一个提交按钮，相对简单，然后我们最好带页面的js校验。emmm，我直接贴代码了~~</p>
<ul>
<li>views/Login.vue</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;<span class="selector-tag">div</span>&gt;</span><br><span class="line">    &lt;el-container&gt;</span><br><span class="line">      &lt;el-<span class="selector-tag">header</span>&gt;</span><br><span class="line">        &lt;router-link <span class="selector-tag">to</span>=&quot;/blogs&quot;&gt;</span><br><span class="line">        &lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;https://www.markerhub.com/dist/images/logo/markerhub-logo.png<span class="string">&quot;</span></span><br><span class="line"><span class="string">             style=&quot;</span>height: <span class="number">60%</span>; <span class="attribute">margin-top</span>: <span class="number">10px</span>;&quot;&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">      &lt;/el-<span class="selector-tag">header</span>&gt;</span><br><span class="line">      &lt;el-<span class="selector-tag">main</span>&gt;</span><br><span class="line">        &lt;el-<span class="selector-tag">form</span> :model=<span class="string">&quot;ruleForm&quot;</span> status-icon :rules=<span class="string">&quot;rules&quot;</span> ref=<span class="string">&quot;ruleForm&quot;</span> label-width=<span class="string">&quot;100px&quot;</span></span><br><span class="line">                 class=<span class="string">&quot;demo-ruleForm&quot;</span>&gt;</span><br><span class="line">          &lt;el-form-item label=<span class="string">&quot;用户名&quot;</span> prop=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">            &lt;el-input type=<span class="string">&quot;text&quot;</span> maxlength=<span class="string">&quot;12&quot;</span> v-model=<span class="string">&quot;ruleForm.username&quot;</span>&gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item label=<span class="string">&quot;密码&quot;</span> prop=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">            &lt;el-input type=<span class="string">&quot;password&quot;</span> v-model=<span class="string">&quot;ruleForm.password&quot;</span> autocomplete=<span class="string">&quot;off&quot;</span>&gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item&gt;</span><br><span class="line">            &lt;el-button type=<span class="string">&quot;primary&quot;</span> @click=<span class="string">&quot;submitForm(&#x27;ruleForm&#x27;)&quot;</span>&gt;登录&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button @click=<span class="string">&quot;resetForm(&#x27;ruleForm&#x27;)&quot;</span>&gt;重置&lt;/el-button&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">      &lt;/el-main&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">    <span class="built_in">data</span>() &#123;</span><br><span class="line">      var validatePass = (rule, value, callback) =&gt; &#123;</span><br><span class="line">        if (value === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">          <span class="built_in">callback</span>(new <span class="built_in">Error</span>(<span class="string">&#x27;请输入密码&#x27;</span>));</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          callback();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      return &#123;</span><br><span class="line">        ruleForm: &#123;</span><br><span class="line">          password: <span class="string">&#x27;111111&#x27;</span>,</span><br><span class="line">          username: <span class="string">&#x27;markerhub&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">          password: [</span><br><span class="line">            &#123;validator: validatePass, trigger: <span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">          ],</span><br><span class="line">          username: [</span><br><span class="line">            &#123;required: true, message: <span class="string">&#x27;请输入用户名&#x27;</span>, trigger: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">            &#123;min: <span class="number">3</span>, max: <span class="number">12</span>, message: <span class="string">&#x27;长度在 3 到 12 个字符&#x27;</span>, trigger: <span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="built_in">submitForm</span>(formName) &#123;</span><br><span class="line">        const _this = this</span><br><span class="line">        this.$refs[formName].<span class="built_in">validate</span>((valid) =&gt; &#123;</span><br><span class="line">          if (valid) &#123;</span><br><span class="line">            // 提交逻辑</span><br><span class="line">            this.$axios.<span class="built_in">post</span>(<span class="string">&#x27;http://localhost:8081/login&#x27;</span>, this.ruleForm).<span class="built_in">then</span>((res)=&gt;&#123;</span><br><span class="line">              const token = res.headers[<span class="string">&#x27;authorization&#x27;</span>]</span><br><span class="line">              _this.$store.<span class="built_in">commit</span>(<span class="string">&#x27;SET_TOKEN&#x27;</span>, token)</span><br><span class="line">              _this.$store.<span class="built_in">commit</span>(<span class="string">&#x27;SET_USERINFO&#x27;</span>, res.data.data)</span><br><span class="line">              _this.$router.<span class="built_in">push</span>(<span class="string">&quot;/blogs&quot;</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            console<span class="selector-class">.log</span>(&#x27;error submit!!&#x27;);</span><br><span class="line">            return false;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      resetForm(formName) &#123;</span><br><span class="line">        this.$refs<span class="selector-attr">[formName]</span><span class="selector-class">.resetFields</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">      this.$notify(&#123;</span><br><span class="line">        title: <span class="string">&#x27;看这里：&#x27;</span>,</span><br><span class="line">        message: <span class="string">&#x27;关注公众号：MarkerHub，回复【vueblog】，领取项目资料与源码&#x27;</span>,</span><br><span class="line">        duration: <span class="number">1500</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>找不到啥好的方式讲解了，之后先贴代码，然后再讲解。 上面代码中，其实主要做了两件事情</p>
<p>1、表单校验</p>
<p>2、登录按钮的点击登录事件</p>
<p>表单校验规则还好，比较固定写法，查一下element-ui的组件就知道了，我们来分析一下发起登录之后的代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const token = res<span class="selector-class">.headers</span><span class="selector-attr">[<span class="string">&#x27;authorization&#x27;</span>]</span></span><br><span class="line">_this.$store<span class="selector-class">.commit</span>(&#x27;SET_TOKEN&#x27;, token)</span><br><span class="line">_this.$store<span class="selector-class">.commit</span>(&#x27;SET_USERINFO&#x27;, res<span class="selector-class">.data</span><span class="selector-class">.data</span>)</span><br><span class="line">_this.$router<span class="selector-class">.push</span>(&quot;/blogs&quot;)</span><br></pre></td></tr></table></figure>

<p>从返回的结果请求头中获取到token的信息，然后使用store提交token和用户信息的状态。完成操作之后，我们调整到了/blogs路由，即博客列表页面。</p>
<h4 id="token的状态同步"><a href="#token的状态同步" class="headerlink" title="token的状态同步"></a>token的状态同步</h4><p>所以在store/index.js中，代码是这样的：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import Vue <span class="selector-tag">from</span> &#x27;vue&#x27;</span><br><span class="line">import Vuex <span class="selector-tag">from</span> &#x27;vuex&#x27;</span><br><span class="line">Vue<span class="selector-class">.use</span>(Vuex)</span><br><span class="line">export default new Vuex<span class="selector-class">.Store</span>(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    token: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    userInfo: JSON.<span class="built_in">parse</span>(sessionStorage.<span class="built_in">getItem</span>(<span class="string">&quot;userInfo&quot;</span>))</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    SET_TOKEN: (state, token) =&gt; &#123;</span><br><span class="line">      state.token = token</span><br><span class="line">      localStorage.<span class="built_in">setItem</span>(<span class="string">&quot;token&quot;</span>, token)</span><br><span class="line">    &#125;,</span><br><span class="line">    SET_USERINFO: (state, userInfo) =&gt; &#123;</span><br><span class="line">      state.userInfo = userInfo</span><br><span class="line">      sessionStorage.<span class="built_in">setItem</span>(<span class="string">&quot;userInfo&quot;</span>, JSON.<span class="built_in">stringify</span>(userInfo))</span><br><span class="line">    &#125;,</span><br><span class="line">    REMOVE_INFO: (state) =&gt; &#123;</span><br><span class="line">      localStorage.<span class="built_in">setItem</span>(<span class="string">&quot;token&quot;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      sessionStorage.<span class="built_in">setItem</span>(<span class="string">&quot;userInfo&quot;</span>, JSON.<span class="built_in">stringify</span>(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">      state.userInfo = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    getUser: state =&gt; &#123;</span><br><span class="line">      return state.userInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;&#125;,</span><br><span class="line">  modules: &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>存储token，我们用的是localStorage，存储用户信息，我们用的是sessionStorage。毕竟用户信息我们不需要长久保存，保存了token信息，我们随时都可以初始化用户信息。当然了因为本项目是个比较简单的项目，考虑到初学者，所以很多相对复杂的封装和功能我没有做，当然了，学了这个项目之后，自己想再继续深入，完成可以自行学习和改造哈。</p>
<h4 id="定义全局axios拦截器"><a href="#定义全局axios拦截器" class="headerlink" title="定义全局axios拦截器"></a>定义全局axios拦截器</h4><p>点击登录按钮发起登录请求，成功时候返回了数据，如果是密码错误，我们是不是也应该弹窗消息提示。为了让这个错误弹窗能运用到所有的地方，所以我对axios做了个后置拦截器，就是返回数据时候，如果结果的code或者status不正常，那么我对应弹窗提示。</p>
<p>在src目录下创建一个文件axios.js（与main.js同级），定义axios的拦截：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">import axios <span class="selector-tag">from</span> &#x27;axios&#x27;</span><br><span class="line">import Element <span class="selector-tag">from</span> &quot;element-ui&quot;;</span><br><span class="line">import store <span class="selector-tag">from</span> &quot;./store&quot;;</span><br><span class="line">import router <span class="selector-tag">from</span> &quot;./router&quot;;</span><br><span class="line">axios<span class="selector-class">.defaults</span><span class="selector-class">.baseURL</span>=&#x27;http://localhost:<span class="number">8081</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">axios.interceptors.request.use(config =&gt; &#123;</span></span><br><span class="line"><span class="string">  console.log(&quot;前置拦截&quot;)</span></span><br><span class="line"><span class="string">  // 可以统一设置请求头</span></span><br><span class="line"><span class="string">  return config</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">axios.interceptors.response.use(response =&gt; &#123;</span></span><br><span class="line"><span class="string">    const res = response.data;</span></span><br><span class="line"><span class="string">    console.log(&quot;后置拦截&quot;)</span></span><br><span class="line"><span class="string">    // 当结果的code是否为200的情况</span></span><br><span class="line"><span class="string">    if (res.code === 200) &#123;</span></span><br><span class="line"><span class="string">      return response</span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">      // 弹窗异常信息</span></span><br><span class="line"><span class="string">      Element.Message(&#123;</span></span><br><span class="line"><span class="string">        message: response.data.msg,</span></span><br><span class="line"><span class="string">        type: &#x27;</span>error<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">        duration: 2 * 1000</span></span><br><span class="line"><span class="string">      &#125;)</span></span><br><span class="line"><span class="string">      // 直接拒绝往下面返回结果信息</span></span><br><span class="line"><span class="string">      return Promise.reject(response.data.msg)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  error =&gt; &#123;</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>err<span class="string">&#x27; + error)// for debug</span></span><br><span class="line"><span class="string">    if(error.response.data) &#123;</span></span><br><span class="line"><span class="string">      error.message = error.response.data.msg</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // 根据请求状态觉得是否登录或者提示其他</span></span><br><span class="line"><span class="string">    if (error.response.status === 401) &#123;</span></span><br><span class="line"><span class="string">      store.commit(&#x27;</span>REMOVE_INFO<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">      router.push(&#123;</span></span><br><span class="line"><span class="string">        path: &#x27;</span>/login<span class="string">&#x27;</span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">      error.message = &#x27;</span>请重新登录<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    if (error.response.status === 403) &#123;</span></span><br><span class="line"><span class="string">      error.message = &#x27;</span>权限不足，无法访问<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    Element.Message(&#123;</span></span><br><span class="line"><span class="string">      message: error.message,</span></span><br><span class="line"><span class="string">      type: &#x27;</span>error<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">      duration: 3 * 1000</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">    return Promise.reject(error)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br></pre></td></tr></table></figure>

<p>前置拦截，其实可以统一为所有需要权限的请求装配上header的token信息，这样不需要在使用是再配置，我的小项目比较小，所以，还是免了吧~</p>
<p>然后再main.js中导入axios.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;./axios.js&#x27; // 请求拦截</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>后端因为返回的实体是Result，succ时候code为200，fail时候返回的是400，所以可以根据这里判断结果是否是正常的。另外权限不足时候可以通过请求结果的状态码来判断结果是否正常。这里都做了简单的处理。</p>
<p>登录异常时候的效果如下：</p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9c0da7a02" alt="图片" style="zoom: 67%;" / loading="lazy">



<h3 id="9、博客列表"><a href="#9、博客列表" class="headerlink" title="9、博客列表"></a>9、博客列表</h3><p>登录完成之后直接进入博客列表页面，然后加载博客列表的数据渲染出来。同时页面头部我们需要把用户的信息展示出来，因为很多地方都用到这个模块，所以我们把页面头部的用户信息单独抽取出来作为一个组件。</p>
<h4 id="头部用户信息"><a href="#头部用户信息" class="headerlink" title="头部用户信息"></a>头部用户信息</h4><p>那么，我们先来完成头部的用户信息，应该包含三部分信息：id，头像、用户名，而这些信息我们是在登录之后就已经存在了sessionStorage。因此，我们可以通过store的getters获取到用户信息。</p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9c4c440a3" alt="图片" style="zoom: 80%;" / loading="lazy">



<p>看起来不是很复杂，我们贴出代码：</p>
<ul>
<li>components\Header.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;m-content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>欢迎来到MarkerHub的博客<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;block&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-avatar</span> <span class="attr">:size</span>=<span class="string">&quot;50&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;user.avatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-avatar</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; user.username &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;maction&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">href</span>=<span class="string">&quot;/blogs&quot;</span>&gt;</span>主页<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-divider</span> <span class="attr">direction</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-divider</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/blog/add&quot;</span> <span class="attr">:disabled</span>=<span class="string">&quot;!hasLogin&quot;</span>&gt;</span>发表文章<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-divider</span> <span class="attr">direction</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-divider</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-show</span>=<span class="string">&quot;!hasLogin&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>登陆<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-show</span>=<span class="string">&quot;hasLogin&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-link</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;logout&quot;</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">el-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">name</span>: <span class="string">&quot;Header&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">hasLogin</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">user</span>: &#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">username</span>: <span class="string">&#x27;请先登录&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">avatar</span>: <span class="string">&quot;https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png&quot;</span></span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">blogs</span>: &#123;&#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">currentPage</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">total</span>: <span class="number">0</span></span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;,</span></span><br><span class="line"><span class="javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">logout</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> _this = <span class="built_in">this</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$axios.get(<span class="string">&#x27;http://localhost:8081/logout&#x27;</span>, &#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="string">&quot;Authorization&quot;</span>: <span class="built_in">localStorage</span>.getItem(<span class="string">&quot;token&quot;</span>)</span></span><br><span class="line"><span class="javascript">          &#125;</span></span><br><span class="line"><span class="javascript">        &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          _this.$store.commit(<span class="string">&#x27;REMOVE_INFO&#x27;</span>)</span></span><br><span class="line"><span class="javascript">          _this.$router.push(<span class="string">&#x27;/login&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(<span class="built_in">this</span>.$store.getters.getUser.username) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.user.username = <span class="built_in">this</span>.$store.getters.getUser.username</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.user.avatar = <span class="built_in">this</span>.$store.getters.getUser.avatar</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.hasLogin = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面代码created()中初始化用户的信息，通过hasLogin的状态来控制登录和退出按钮的切换，以及发表文章链接的disabled，这样用户的信息就能展示出来了。 然后这里有个退出按钮，在methods中有个logout()方法，逻辑比较简单，直接访问/logout，因为之前axios.js中我们已经设置axios请求的baseURL，所以这里我们不再需要链接的前缀了哈。因为是登录之后才能访问的受限资源，所以在header中带上了Authorization。返回结果清楚store中的用户信息和token信息，跳转到登录页面。</p>
<p>然后需要头部用户信息的页面只需要几个步骤：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import <span class="selector-tag">Header</span> <span class="selector-tag">from</span> &quot;@/components/Header&quot;;</span><br><span class="line">data() &#123;</span><br><span class="line">  components: &#123;Header&#125;</span><br><span class="line">&#125;</span><br><span class="line"># 然后模板中调用组件</span><br><span class="line">&lt;<span class="selector-tag">Header</span>&gt;&lt;/<span class="selector-tag">Header</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="博客分页"><a href="#博客分页" class="headerlink" title="博客分页"></a>博客分页</h4><p>接下来就是列表页面，需要做分页，列表我们在element-ui中直接使用<strong>时间线</strong>组件来作为我们的列表样式，还是挺好看的。还有我们的分页组件。</p>
<p>需要几部分信息：</p>
<ul>
<li>分页信息</li>
<li>博客列表内容，包括id、标题、摘要、创建时间</li>
<li>views\Blogs.vue</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;<span class="selector-tag">div</span> class=&quot;m-container&quot;&gt;</span><br><span class="line">    &lt;<span class="selector-tag">Header</span>&gt;&lt;/<span class="selector-tag">Header</span>&gt;</span><br><span class="line">    &lt;<span class="selector-tag">div</span> class=&quot;block&quot;&gt;</span><br><span class="line">      &lt;el-timeline&gt;</span><br><span class="line">        &lt;el-timeline-item v-bind:timestamp=<span class="string">&quot;blog.created&quot;</span> placement=<span class="string">&quot;top&quot;</span> v-for=<span class="string">&quot;blog in blogs&quot;</span>&gt;</span><br><span class="line">          &lt;el-card&gt;</span><br><span class="line">            &lt;h4&gt;&lt;router-link :to=<span class="string">&quot;&#123;name: &#x27;BlogDetail&#x27;, params: &#123;blogId: blog.id&#125;&#125;&quot;</span>&gt;&#123;&#123;blog.title&#125;&#125;&lt;/router-link&gt;&lt;/<span class="selector-tag">h4</span>&gt;</span><br><span class="line">            &lt;<span class="selector-tag">p</span>&gt;&#123;&#123;blog<span class="selector-class">.description</span>&#125;&#125;&lt;/<span class="selector-tag">p</span>&gt;</span><br><span class="line">          &lt;/el-card&gt;</span><br><span class="line">        &lt;/el-timeline-item&gt;</span><br><span class="line">      &lt;/el-timeline&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">    &lt;el-pagination class=&quot;mpage&quot;</span><br><span class="line">      <span class="attribute">background</span></span><br><span class="line">      layout=&quot;prev, pager, next&quot;</span><br><span class="line">      <span class="selector-pseudo">:current</span>-page=currentPage</span><br><span class="line">      :page-size=pageSize</span><br><span class="line">      @current-change=page</span><br><span class="line">      :total=<span class="string">&quot;total&quot;</span>&gt;</span><br><span class="line">    &lt;/el-pagination&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import Header from <span class="string">&quot;@/components/Header&quot;</span>;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: <span class="string">&quot;Blogs&quot;</span>,</span><br><span class="line">    components: &#123;Header&#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        blogs: &#123;&#125;,</span><br><span class="line">        currentPage: <span class="number">1</span>,</span><br><span class="line">        total: <span class="number">0</span>,</span><br><span class="line">        pageSize: <span class="number">5</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="built_in">page</span>(currentPage) &#123;</span><br><span class="line">        const _this = this</span><br><span class="line">        this.$axios.<span class="built_in">get</span>(<span class="string">&#x27;http://localhost:8081/blogs?currentPage=&#x27;</span> + currentPage).<span class="built_in">then</span>((res) =&gt; &#123;</span><br><span class="line">          console.<span class="built_in">log</span>(res.data.data.records)</span><br><span class="line">          _this.blogs = res.data.data.records</span><br><span class="line">          _this.currentPage = res.data.data.current</span><br><span class="line">          _this.total = res.data.data.total</span><br><span class="line">          _this.pageSize = res.data.data.size</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted () &#123;</span><br><span class="line">      this<span class="selector-class">.page</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>data()中直接定义博客列表blogs、以及一些分页信息。methods()中定义分页的调用接口page（currentPage），参数是需要调整的页码currentPage，得到结果之后直接赋值即可。然后初始化时候，直接在mounted()方法中调用第一页this.page(1)。完美。使用element-ui组件就是简单快捷哈哈！ 注意标题这里我们添加了链接，使用的是标签。</p>
<h3 id="10、博客编辑（发表）"><a href="#10、博客编辑（发表）" class="headerlink" title="10、博客编辑（发表）"></a>10、博客编辑（发表）</h3><p>我们点击发表博客链接调整到/blog/add页面，这里我们需要用到一个markdown编辑器，在vue组件中，比较好用的是mavon-editor，那么我们直接使用哈。先来安装mavon-editor相关组件：</p>
<h4 id="安装mavon-editor"><a href="#安装mavon-editor" class="headerlink" title="安装mavon-editor"></a>安装mavon-editor</h4><p>基于Vue的markdown编辑器mavon-editor</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install mavon-editor --save</span><br></pre></td></tr></table></figure>

<p>然后在main.js中全局注册：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 全局注册</span><br><span class="line">import Vue <span class="selector-tag">from</span> &#x27;vue&#x27;</span><br><span class="line">import mavonEditor <span class="selector-tag">from</span> &#x27;mavon-editor&#x27;</span><br><span class="line">import &#x27;mavon-editor/dist/css/index<span class="selector-class">.css</span>&#x27;</span><br><span class="line">// use</span><br><span class="line">Vue<span class="selector-class">.use</span>(mavonEditor)</span><br></pre></td></tr></table></figure>

<p>ok，那么我们去定义我们的博客表单：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;<span class="selector-tag">div</span> class=&quot;m-container&quot;&gt;</span><br><span class="line">    &lt;<span class="selector-tag">Header</span>&gt;&lt;/<span class="selector-tag">Header</span>&gt;</span><br><span class="line">    &lt;<span class="selector-tag">div</span> class=&quot;m-<span class="attribute">content</span>&quot;&gt;</span><br><span class="line">      &lt;el-<span class="selector-tag">form</span> ref=&quot;editForm&quot; status-<span class="attribute">icon</span> :model=<span class="string">&quot;editForm&quot;</span> :rules=<span class="string">&quot;rules&quot;</span> label-width=<span class="string">&quot;80px&quot;</span>&gt;</span><br><span class="line">        &lt;el-form-item label=<span class="string">&quot;标题&quot;</span> prop=<span class="string">&quot;title&quot;</span>&gt;</span><br><span class="line">          &lt;el-input v-model=<span class="string">&quot;editForm.title&quot;</span>&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=<span class="string">&quot;摘要&quot;</span> prop=<span class="string">&quot;description&quot;</span>&gt;</span><br><span class="line">          &lt;el-input type=<span class="string">&quot;textarea&quot;</span> v-model=<span class="string">&quot;editForm.description&quot;</span>&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=<span class="string">&quot;内容&quot;</span> prop=<span class="string">&quot;content&quot;</span>&gt;</span><br><span class="line">          &lt;mavon-editor v-model=<span class="string">&quot;editForm.content&quot;</span>/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;el-button type=<span class="string">&quot;primary&quot;</span> @click=<span class="string">&quot;submitForm()&quot;</span>&gt;立即创建&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button&gt;取消&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import Header from <span class="string">&quot;@/components/Header&quot;</span>;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: <span class="string">&quot;BlogEdit&quot;</span>,</span><br><span class="line">    components: &#123;Header&#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        editForm: &#123;</span><br><span class="line">          id: null,</span><br><span class="line">          title: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">          description: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">          content: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">          title: [</span><br><span class="line">            &#123;required: true, message: <span class="string">&#x27;请输入标题&#x27;</span>, trigger: <span class="string">&#x27;blur&#x27;</span>&#125;,</span><br><span class="line">            &#123;min: <span class="number">3</span>, max: <span class="number">50</span>, message: <span class="string">&#x27;长度在 3 到 50 个字符&#x27;</span>, trigger: <span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">          ],</span><br><span class="line">          description: [</span><br><span class="line">            &#123;required: true, message: <span class="string">&#x27;请输入摘要&#x27;</span>, trigger: <span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      const blogId = this.$route<span class="selector-class">.params</span><span class="selector-class">.blogId</span></span><br><span class="line">      const _this = this</span><br><span class="line">      if(blogId) &#123;</span><br><span class="line">        this.$axios<span class="selector-class">.get</span>(&#x27;/blog/&#x27; + blogId)<span class="selector-class">.then</span>((res) =&gt; &#123;</span><br><span class="line">          const blog = res<span class="selector-class">.data</span><span class="selector-class">.data</span></span><br><span class="line">          _this<span class="selector-class">.editForm</span><span class="selector-class">.id</span> = blog<span class="selector-class">.id</span></span><br><span class="line">          _this<span class="selector-class">.editForm</span><span class="selector-class">.title</span> = blog<span class="selector-class">.title</span></span><br><span class="line">          _this<span class="selector-class">.editForm</span><span class="selector-class">.description</span> = blog<span class="selector-class">.description</span></span><br><span class="line">          _this<span class="selector-class">.editForm</span><span class="selector-class">.content</span> = blog<span class="selector-class">.content</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="built_in">submitForm</span>() &#123;</span><br><span class="line">        const _this = this</span><br><span class="line">        this.$refs.editForm.<span class="built_in">validate</span>((valid) =&gt; &#123;</span><br><span class="line">          if (valid) &#123;</span><br><span class="line">            this.$axios.<span class="built_in">post</span>(<span class="string">&#x27;/blog/edit&#x27;</span>, this.editForm, &#123;</span><br><span class="line">              headers: &#123;</span><br><span class="line">                <span class="string">&quot;Authorization&quot;</span>: localStorage.<span class="built_in">getItem</span>(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)<span class="selector-class">.then</span>((res) =&gt; &#123;</span><br><span class="line">              _this.$alert(&#x27;操作成功&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">                confirmButtonText: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">                callback: action =&gt; &#123;</span><br><span class="line">                  _this.$router.<span class="built_in">push</span>(<span class="string">&quot;/blogs&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            console<span class="selector-class">.log</span>(&#x27;error submit!!&#x27;);</span><br><span class="line">            return false;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>逻辑依然简单，校验表单，然后点击按钮提交表单，注意头部加上Authorization信息，返回结果弹窗提示操作成功，然后跳转到博客列表页面。emm，和写ajax没啥区别。熟悉一下vue的一些指令使用即可。 然后因为编辑和添加是同一个页面，所以有了create()方法，比如从编辑连接/blog/7/edit中获取blogId为7的这个id。然后回显博客信息。获取方式是const blogId = this.$route.params.blogId。</p>
<p>对了，mavon-editor因为已经全局注册，所以我们直接使用组件即可：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mavon-editor v-model=&quot;editForm<span class="selector-class">.content</span>&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>效果如下： </p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9cb783513" alt="图片" style="zoom:67%;" / loading="lazy">



<h3 id="11、博客详情"><a href="#11、博客详情" class="headerlink" title="11、博客详情"></a>11、博客详情</h3><p>博客详情中需要回显博客信息，然后有个问题就是，后端传过来的是博客内容是markdown格式的内容，我们需要进行渲染然后显示出来，这里我们使用一个插件markdown-it，用于解析md文档，然后导入github-markdown-c，所谓md的样式。</p>
<p>方法如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用于解析md文档</span></span><br><span class="line"><span class="attr">cnpm</span> <span class="string">install markdown-it --save</span></span><br><span class="line"><span class="comment"># md样式</span></span><br><span class="line"><span class="attr">cnpm</span> <span class="string">install github-markdown-css</span></span><br></pre></td></tr></table></figure>

<p>然后就可以在需要渲染的地方使用：</p>
<ul>
<li>views\BlogDetail.vue</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;<span class="selector-tag">div</span> class=&quot;m-container&quot;&gt;</span><br><span class="line">    &lt;<span class="selector-tag">Header</span>&gt;&lt;/<span class="selector-tag">Header</span>&gt;</span><br><span class="line">    &lt;<span class="selector-tag">div</span> class=&quot;mblog&quot;&gt;</span><br><span class="line">      &lt;<span class="selector-tag">h2</span>&gt;&#123;&#123; blog<span class="selector-class">.title</span> &#125;&#125;&lt;/<span class="selector-tag">h2</span>&gt;</span><br><span class="line">      &lt;el-link <span class="attribute">icon</span>=&quot;el-<span class="attribute">icon</span>-edit&quot; v-if=&quot;ownBlog&quot;&gt;&lt;router-link :to=<span class="string">&quot;&#123;name: &#x27;BlogEdit&#x27;, params: &#123;blogId: blog.id&#125;&#125;&quot;</span>&gt;编辑&lt;/router-link&gt;&lt;/el-link&gt;</span><br><span class="line">      &lt;el-divider&gt;&lt;/el-divider&gt;</span><br><span class="line">      &lt;div class=<span class="string">&quot;content markdown-body&quot;</span> v-html=<span class="string">&quot;blog.content&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import <span class="string">&#x27;github-markdown-css/github-markdown.css&#x27;</span> // 然后添加样式markdown-body</span><br><span class="line">  import Header from <span class="string">&quot;@/components/Header&quot;</span>;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: <span class="string">&quot;BlogDetail&quot;</span>,</span><br><span class="line">    components: &#123;</span><br><span class="line">      Header</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        blog: &#123;</span><br><span class="line">          userId: null,</span><br><span class="line">          title: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          description: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          content: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        ownBlog: false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="built_in">getBlog</span>() &#123;</span><br><span class="line">        const blogId = this.$route.params.blogId</span><br><span class="line">        const _this = this</span><br><span class="line">        this.$axios.<span class="built_in">get</span>(<span class="string">&#x27;/blog/&#x27;</span> + blogId).<span class="built_in">then</span>((res) =&gt; &#123;</span><br><span class="line">          console.<span class="built_in">log</span>(res)</span><br><span class="line">          console.<span class="built_in">log</span>(res.data.data)</span><br><span class="line">          _this.blog = res.data.data</span><br><span class="line">          var MarkdownIt = <span class="built_in">require</span>(<span class="string">&#x27;markdown-it&#x27;</span>),</span><br><span class="line">            md = new <span class="built_in">MarkdownIt</span>();</span><br><span class="line">          <span class="selector-tag">var</span> result = md<span class="selector-class">.render</span>(_this<span class="selector-class">.blog</span><span class="selector-class">.content</span>);</span><br><span class="line">          _this<span class="selector-class">.blog</span><span class="selector-class">.content</span> = result</span><br><span class="line">          // 判断是否是自己的文章，能否编辑</span><br><span class="line">          _this<span class="selector-class">.ownBlog</span> =  (_this<span class="selector-class">.blog</span><span class="selector-class">.userId</span> === _this.$store<span class="selector-class">.getters</span><span class="selector-class">.getUser</span><span class="selector-class">.id</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      this<span class="selector-class">.getBlog</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>具体逻辑还是挺简单，初始化create()方法中调用getBlog()方法，请求博客详情接口，返回的博客详情content通过markdown-it工具进行渲染。</p>
<p>再导入样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;github-markdown<span class="selector-class">.css</span>&#x27;</span><br></pre></td></tr></table></figure>

<p>然后在content的div中添加class为markdown-body即可哈。 效果如下：</p>
<img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB.assets/1725bae9d7e97e21" alt="图片" style="zoom: 50%;" / loading="lazy">



<p>另外标题下添加了个小小的编辑按钮，通过ownBlog （判断博文作者与登录用户是否同一人）来判断按钮是否显示出来。</p>
<h3 id="12、路由权限拦截"><a href="#12、路由权限拦截" class="headerlink" title="12、路由权限拦截"></a>12、路由权限拦截</h3><p>页面已经开发完毕之后，我们来控制一下哪些页面是需要登录之后才能跳转的，如果未登录访问就直接重定向到登录页面，因此我们在src目录下定义一个js文件：</p>
<ul>
<li>src\permission.js</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router from <span class="string">&quot;./router&quot;</span>;</span><br><span class="line"><span class="comment">// 路由判断登录 根据路由配置文件的参数</span></span><br><span class="line">router.beforeEach((to, from, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.matched.some(record =&gt; record.meta.requireAuth)) &#123; <span class="comment">// 判断该路由是否需要登录权限</span></span><br><span class="line">    <span class="keyword">const</span> token = localStorage.getItem(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    console.log(<span class="string">&quot;------------&quot;</span> + token)</span><br><span class="line">    <span class="keyword">if</span> (token) &#123; <span class="comment">// 判断当前的token是否存在 ； 登录存入的token</span></span><br><span class="line">      <span class="keyword">if</span> (to.path === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      next(&#123;</span><br><span class="line">        path: <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>通过之前我们再定义页面路由时候的的meta信息，指定requireAuth: true，需要登录才能访问，因此这里我们在每次路由之前（router.beforeEach）判断token的状态，觉得是否需要跳转到登录页面。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/blog/add&#x27;</span>, <span class="comment">// 注意放在 path: &#x27;/blog/:blogId&#x27;之前</span></span><br><span class="line">  name: <span class="string">&#x27;BlogAdd&#x27;</span>,</span><br><span class="line">  meta: &#123;</span><br><span class="line">    requireAuth: <span class="keyword">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  component: BlogEdit</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们再main.js中import我们的permission.js</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./permission.js&#x27;</span> <span class="comment">// 路由拦截</span></span><br></pre></td></tr></table></figure>

<h3 id="13、前端总结"><a href="#13、前端总结" class="headerlink" title="13、前端总结"></a>13、前端总结</h3><p>ok，基本所有页面就已经开发完毕啦，css样式信息我未贴出来，大家直接上github上clone下来查看。</p>
<p>作者：MarkerHub链接：<a target="_blank" rel="noopener" href="https://juejin.im/post/5ecfca676fb9a04793456fb8%E6%9D%A5%E6%BA%90%EF%BC%9A%E6%8E%98%E9%87%91%E8%91%97%E4%BD%9C%E6%9D%83%E5%BD%92%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E5%95%86%E4%B8%9A%E8%BD%AC%E8%BD%BD%E8%AF%B7%E8%81%94%E7%B3%BB%E4%BD%9C%E8%80%85%E8%8E%B7%E5%BE%97%E6%8E%88%E6%9D%83%EF%BC%8C%E9%9D%9E%E5%95%86%E4%B8%9A%E8%BD%AC%E8%BD%BD%E8%AF%B7%E6%B3%A8%E6%98%8E%E5%87%BA%E5%A4%84%E3%80%82">https://juejin.im/post/5ecfca676fb9a04793456fb8来源：掘金著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</a></p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://i.loli.net/2021/07/27/kcALMgvjIFhKVfH.jpg"><img loading="lazy" src="https://i.loli.net/2021/07/27/kcALMgvjIFhKVfH.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://i.loli.net/2021/07/27/oI5KPrjHLt7iOme.jpg"><img loading="lazy" src="https://i.loli.net/2021/07/27/oI5KPrjHLt7iOme.jpg" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://i.loli.net/2021/07/27/PCJNbqAlHpGWKEV.jpg"><img loading="lazy" src="https://i.loli.net/2021/07/27/PCJNbqAlHpGWKEV.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>John Doe</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/" title="">http://example.com/2021/07/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2021/07/28/%E9%A1%B9%E7%9B%AE%E8%A7%84%E5%88%99/" rel="prev" title=""><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text"></span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/07/28/Vue/" rel="next" title=""><span class="post-nav-text"></span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> John Doe</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.4.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.1</span></div><div class="live_time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2021-06-17T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>